Task-5:
1st half :

CREATE DATABASE salesdb;
SHOW DATABASES;
USE salesdb;
SELECT current_database();

2nd half:

CREATE TABLE customer (
  customer_id INT,
  customer_name STRING,
  email STRING,
  phone STRING
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE;


CREATE TABLE product (
  product_id INT,
  product_name STRING,
  category STRING,
  price DOUBLE
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE;


CREATE TABLE sales_order (
  order_id INT,
  customer_id INT,
  product_id INT,
  order_date TIMESTAMP,
  order_amount DOUBLE,
  quantity INT,
  total_amount DOUBLE
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE;


gedit customer.csv

1,John Doe,john@example.com,9876543210
2,Alice Smith,alice@example.com,9876543220
3,Ravi Kumar,ravi@example.com,9876543230


gedit product.csv

101,Laptop,Electronics,50000
102,Mobile,Electronics,20000
103,Table,Home,8000

gedit sales_order.csv


1001,1,101,2024-05-10 10:00:00,50000,1,49500
1002,2,102,2024-05-12 11:00:00,40000,2,38800
1003,3,103,2024-06-01 12:00:00,16000,2,15700
1004,1,102,2024-06-15 14:00:00,20000,1,19800



LOAD DATA local INPATH '/home/cloudera/customer.csv' INTO TABLE customer;
LOAD DATA local INPATH '/home/cloudera/product.csv' INTO TABLE product;
LOAD DATA local INPATH '/home/cloudera/sales_order.csv' INTO TABLE sales_order;


a)SELECT SUM(total_amount) AS total_sales_amount
FROM sales_order;
o/p:123800.0



b)SELECT p.product_name,SUM(s.total_amount) AS total_sales FROM sales_order s JOIN product p ON s.product_id = p.product_id GROUP BY p.product_name ORDER BY total_sales DESC
  LIMIT 2;
  
  o/p:Mobile	58600.0
Laptop	49500.0

  
c)
SELECT c.customer_name,
       SUM(s.total_amount) AS total_sales
FROM sales_order s
JOIN customer c ON s.customer_id = c.customer_id
GROUP BY c.customer_name;
o/p:Alice Smith	38800.0
John Doe	69300.0
Ravi Kumar	15700.0




d)SELECT date_format(order_date, 'yyyy-MM') AS month,
       SUM(total_amount) AS monthly_sales
FROM sales_order
GROUP BY date_format(order_date, 'yyyy-MM')
ORDER BY month;

o/p:2024-05	88300.0
2024-06	35500.0



e) SELECT p.product_name,
       SUM(s.quantity) AS total_quantity
FROM sales_order s
JOIN product p ON s.product_id = p.product_id
GROUP BY p.product_name;

o/p:
Laptop	1
Mobile	3


f)
SELECT p.category,
       p.product_name,
       p.price AS highest_price
FROM product p
JOIN (
    SELECT category, MAX(price) AS max_price
    FROM product
    GROUP BY category
) m
ON p.category = m.category AND p.price = m.max_price;


o/p:Electronics	Laptop	50000.0
Home	Table	8000.0